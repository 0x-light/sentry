import{t as b,r as c,j as e,H as w,Q as u,c as x,o as v,I as C,ac as S,ad as P}from"./index-DnyENzFv.js";import{D,a as F,b as k,c as A,d as L}from"./dialog-C2hEiaiA.js";import{S as R}from"./switch-Cj4DDvt3.js";import"./index-C-aOu7yy.js";const U=[{id:"starter",name:"Starter",credits:1e3,price:900,perCredit:.009,estimates:[{label:"~20 daily scans",count:20}]},{id:"standard",name:"Standard",credits:5e3,price:3900,perCredit:.0078,savings:"13%",recommended:!0,estimates:[{label:"~100 daily scans",count:100}]},{id:"pro",name:"Pro",credits:15e3,price:9900,perCredit:.0066,savings:"27%",estimates:[{label:"~300 daily scans",count:300}]},{id:"max",name:"Max",credits:4e4,price:19900,perCredit:.005,savings:"45%",estimates:[{label:"~800 daily scans",count:800}]}];function I({open:g,onOpenChange:p}){const{isAuthenticated:n,profile:a}=b(),[i,l]=c.useState(null),[o,h]=c.useState(!1),[d,r]=c.useState(null),[m,f]=c.useState(!1),j=async s=>{if(n){l(s),r(null);try{const{url:t}=await S({packId:s,recurring:o,successUrl:window.location.origin+"/?billing=success",cancelUrl:window.location.origin+"/?billing=cancel"});t?window.location.href=t:r("No checkout URL returned. Please try again.")}catch(t){r(t.message||"Failed to start checkout")}finally{l(null)}}},y=async()=>{if(n){l("portal"),r(null);try{const{url:s}=await P();s?window.location.href=s:r("No billing portal URL returned. Please try again.")}catch(s){r(s.message||"Failed to open billing portal")}finally{l(null)}}},N=s=>new Intl.NumberFormat("en-US",{style:"currency",currency:"usd",minimumFractionDigits:0}).format(s/100);return e.jsx(D,{open:g,onOpenChange:p,children:e.jsx(F,{className:"pricing-dialog sm:max-w-lg w-full",children:e.jsxs("div",{className:"px-6 pt-6 pb-6 space-y-5 overflow-y-auto",children:[e.jsxs(k,{children:[e.jsx(A,{children:"Credits"}),e.jsx(L,{children:n&&a?e.jsxs(e.Fragment,{children:[(a.credits_balance||0).toLocaleString()," credits remaining"]}):e.jsx(e.Fragment,{children:"1 credit = 1 account scanned"})})]}),d&&e.jsx("p",{className:"text-sm text-destructive text-center",children:d}),e.jsx("div",{className:"pricing-packs space-y-2",children:U.map(s=>{var t;return e.jsxs("button",{className:x("credit-pack w-full flex items-center gap-3 p-3 rounded-lg border text-left transition-colors","hover:border-foreground/20",s.recommended&&"recommended border-primary/60 bg-primary/[0.03]"),onClick:()=>j(s.id),disabled:!!i,children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm font-medium",children:s.name}),s.savings&&e.jsxs("span",{className:"text-[10px] text-muted-foreground/70",children:["-",s.savings]}),s.recommended&&e.jsx(w,{variant:"default",className:"text-[10px] px-1.5 py-0",children:"Popular"})]}),e.jsxs("span",{className:"text-xs text-muted-foreground",children:[s.credits.toLocaleString()," credits",e.jsx("span",{className:"mx-1 opacity-40",children:"·"}),(t=s.estimates[0])==null?void 0:t.label]})]}),e.jsx("div",{className:"shrink-0 text-right",children:i===s.id?e.jsx(u,{className:"h-4 w-4 animate-spin"}):e.jsxs("span",{className:"text-sm font-semibold tabular-nums",children:[N(s.price),o&&e.jsx("span",{className:"text-xs font-normal text-muted-foreground",children:"/mo"})]})})]},s.id)})}),e.jsxs("label",{className:"flex items-center justify-between cursor-pointer py-1",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Auto-refill monthly"}),e.jsx(R,{checked:o,onCheckedChange:h})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("button",{className:"flex items-center gap-1.5 text-xs text-muted-foreground/60 hover:text-muted-foreground transition-colors",onClick:()=>f(s=>!s),children:[e.jsx(v,{className:x("h-3 w-3 transition-transform",!m&&"-rotate-90")}),"How credits work"]}),m&&e.jsxs("div",{className:"text-xs text-muted-foreground/70 space-y-0.5 pl-4.5",children:[e.jsx("p",{children:"Credits = accounts × range × model"}),e.jsx("p",{children:"Range: today ×1 · 3d ×2 · week ×3 · 2w ×5 · month ×8"}),e.jsx("p",{children:"Model: Haiku ×0.25 · Sonnet ×1 · Opus ×5"}),e.jsx("p",{className:"pt-1 text-muted-foreground/50",children:"Example: 200 accounts × today × Haiku = 50 credits"})]})]}),e.jsx("p",{className:"text-xs text-muted-foreground/50 text-center",children:"Free tier: bring your own API keys for unlimited scans."}),(a==null?void 0:a.subscription_status)==="active"&&e.jsx(C,{variant:"ghost",size:"sm",className:"w-full text-muted-foreground",onClick:y,disabled:!!i,children:i==="portal"?e.jsx(u,{className:"h-4 w-4 animate-spin"}):"Manage subscription"}),!n&&e.jsx("p",{className:"text-sm text-muted-foreground text-center",children:"Sign in to purchase credits."}),e.jsx("p",{className:"text-[10px] text-muted-foreground/40 text-center",children:"Payments by Stripe. Apple Pay & Google Pay supported."})]})})})}export{I as PricingDialog};
